-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.actividades
(
    id_actividad bigserial NOT NULL,
    tipo character varying(50) COLLATE pg_catalog."default" NOT NULL,
    id_usuario bigint,
    id_equipo bigint,
    id_evento bigint,
    descripcion text COLLATE pg_catalog."default",
    metadata json,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT actividades_pkey PRIMARY KEY (id_actividad)
);

CREATE TABLE IF NOT EXISTS public.avances
(
    id_avance bigserial NOT NULL,
    id_proyecto bigint NOT NULL,
    id_usuario_registro bigint NOT NULL,
    titulo character varying(100) COLLATE pg_catalog."default",
    descripcion text COLLATE pg_catalog."default" NOT NULL,
    archivo_evidencia character varying(255) COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT avances_pkey PRIMARY KEY (id_avance)
);

CREATE TABLE IF NOT EXISTS public.cache
(
    key character varying(255) COLLATE pg_catalog."default" NOT NULL,
    value text COLLATE pg_catalog."default" NOT NULL,
    expiration integer NOT NULL,
    CONSTRAINT cache_pkey PRIMARY KEY (key)
);

CREATE TABLE IF NOT EXISTS public.cache_locks
(
    key character varying(255) COLLATE pg_catalog."default" NOT NULL,
    owner character varying(255) COLLATE pg_catalog."default" NOT NULL,
    expiration integer NOT NULL,
    CONSTRAINT cache_locks_pkey PRIMARY KEY (key)
);

CREATE TABLE IF NOT EXISTS public.cat_carreras
(
    id_carrera bigserial NOT NULL,
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT cat_carreras_pkey PRIMARY KEY (id_carrera),
    CONSTRAINT cat_carreras_nombre_unique UNIQUE (nombre)
);

CREATE TABLE IF NOT EXISTS public.cat_habilidades
(
    id_habilidad bigserial NOT NULL,
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    categoria character varying(50) COLLATE pg_catalog."default",
    icono character varying(50) COLLATE pg_catalog."default",
    color character varying(20) COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT cat_habilidades_pkey PRIMARY KEY (id_habilidad),
    CONSTRAINT cat_habilidades_nombre_unique UNIQUE (nombre)
);

CREATE TABLE IF NOT EXISTS public.cat_roles_equipo
(
    id_rol_equipo bigserial NOT NULL,
    nombre character varying(50) COLLATE pg_catalog."default" NOT NULL,
    descripcion text COLLATE pg_catalog."default",
    CONSTRAINT cat_roles_equipo_pkey PRIMARY KEY (id_rol_equipo)
);

CREATE TABLE IF NOT EXISTS public.cat_roles_sistema
(
    id_rol_sistema bigserial NOT NULL,
    nombre character varying(20) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT cat_roles_sistema_pkey PRIMARY KEY (id_rol_sistema),
    CONSTRAINT cat_roles_sistema_nombre_unique UNIQUE (nombre)
);

CREATE TABLE IF NOT EXISTS public.constancias
(
    id_constancia bigserial NOT NULL,
    id_usuario bigint NOT NULL,
    id_evento bigint NOT NULL,
    tipo character varying(50) COLLATE pg_catalog."default" NOT NULL,
    folio_uuid uuid NOT NULL,
    url_descarga character varying(255) COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT constancias_pkey PRIMARY KEY (id_constancia)
);

CREATE TABLE IF NOT EXISTS public.criterios_evaluacion
(
    id_criterio bigserial NOT NULL,
    id_evento bigint NOT NULL,
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    descripcion text COLLATE pg_catalog."default",
    ponderacion integer NOT NULL,
    CONSTRAINT criterios_evaluacion_pkey PRIMARY KEY (id_criterio)
);

CREATE TABLE IF NOT EXISTS public.equipos
(
    id_equipo bigserial NOT NULL,
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    descripcion text COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    ruta_imagen character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT equipos_pkey PRIMARY KEY (id_equipo)
);

CREATE TABLE IF NOT EXISTS public.estudiante_habilidades
(
    id_usuario bigint NOT NULL,
    id_habilidad bigint NOT NULL,
    nivel character varying(20) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Básico'::character varying,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT estudiante_habilidades_pkey PRIMARY KEY (id_usuario, id_habilidad)
);

CREATE TABLE IF NOT EXISTS public.estudiante_stats
(
    id_usuario bigint NOT NULL,
    total_xp integer NOT NULL DEFAULT 0,
    nivel integer NOT NULL DEFAULT 1,
    eventos_participados integer NOT NULL DEFAULT 0,
    proyectos_completados integer NOT NULL DEFAULT 0,
    veces_lider integer NOT NULL DEFAULT 0,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT estudiante_stats_pkey PRIMARY KEY (id_usuario)
);

CREATE TABLE IF NOT EXISTS public.estudiantes
(
    id_usuario bigint NOT NULL,
    numero_control character varying(20) COLLATE pg_catalog."default" NOT NULL,
    semestre integer NOT NULL,
    id_carrera bigint NOT NULL,
    CONSTRAINT estudiantes_pkey PRIMARY KEY (id_usuario),
    CONSTRAINT estudiantes_numero_control_unique UNIQUE (numero_control)
);

CREATE TABLE IF NOT EXISTS public.evaluacion_criterios
(
    id bigserial NOT NULL,
    id_evaluacion bigint NOT NULL,
    id_criterio bigint NOT NULL,
    calificacion numeric(5, 2) NOT NULL,
    CONSTRAINT evaluacion_criterios_pkey PRIMARY KEY (id),
    CONSTRAINT evaluacion_criterios_id_evaluacion_id_criterio_unique UNIQUE (id_evaluacion, id_criterio)
);

CREATE TABLE IF NOT EXISTS public.evaluaciones
(
    id_evaluacion bigserial NOT NULL,
    id_inscripcion bigint NOT NULL,
    id_jurado bigint NOT NULL,
    calificacion_final numeric(5, 2),
    comentarios_fortalezas text COLLATE pg_catalog."default",
    comentarios_areas_mejora text COLLATE pg_catalog."default",
    comentarios_generales text COLLATE pg_catalog."default",
    estado character varying(255) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Borrador'::character varying,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT evaluaciones_pkey PRIMARY KEY (id_evaluacion),
    CONSTRAINT evaluaciones_id_inscripcion_id_jurado_unique UNIQUE (id_inscripcion, id_jurado)
);

CREATE TABLE IF NOT EXISTS public.evaluaciones_avances
(
    id bigserial NOT NULL,
    id_avance bigint NOT NULL,
    id_jurado bigint NOT NULL,
    calificacion integer NOT NULL,
    comentarios text COLLATE pg_catalog."default",
    fecha_evaluacion timestamp(0) without time zone NOT NULL,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT evaluaciones_avances_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.evento_jurados
(
    id_evento bigint NOT NULL,
    id_jurado bigint NOT NULL,
    rol_en_evento character varying(50) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Evaluador General'::character varying,
    CONSTRAINT evento_jurados_pkey PRIMARY KEY (id_evento, id_jurado)
);

CREATE TABLE IF NOT EXISTS public.eventos
(
    id_evento bigserial NOT NULL,
    nombre character varying(150) COLLATE pg_catalog."default" NOT NULL,
    descripcion text COLLATE pg_catalog."default",
    fecha_inicio timestamp(0) without time zone NOT NULL,
    fecha_fin timestamp(0) without time zone NOT NULL,
    cupo_max_equipos integer NOT NULL,
    estado character varying(255) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Próximo'::character varying,
    ruta_imagen character varying(255) COLLATE pg_catalog."default",
    deleted_at timestamp(0) without time zone,
    tipo_proyecto character varying(20) COLLATE pg_catalog."default",
    CONSTRAINT eventos_pkey PRIMARY KEY (id_evento)
);

CREATE TABLE IF NOT EXISTS public.failed_jobs
(
    id bigserial NOT NULL,
    uuid character varying(255) COLLATE pg_catalog."default" NOT NULL,
    connection text COLLATE pg_catalog."default" NOT NULL,
    queue text COLLATE pg_catalog."default" NOT NULL,
    payload text COLLATE pg_catalog."default" NOT NULL,
    exception text COLLATE pg_catalog."default" NOT NULL,
    failed_at timestamp(0) without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT failed_jobs_pkey PRIMARY KEY (id),
    CONSTRAINT failed_jobs_uuid_unique UNIQUE (uuid)
);

CREATE TABLE IF NOT EXISTS public.funcionalidades_avanzadas_tables
(
    id bigserial NOT NULL,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT funcionalidades_avanzadas_tables_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.inscripciones_evento
(
    id_inscripcion bigserial NOT NULL,
    id_equipo bigint NOT NULL,
    id_evento bigint,
    codigo_acceso_equipo character varying(20) COLLATE pg_catalog."default",
    fecha_inscripcion timestamp(0) without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    puesto_ganador integer,
    status_registro character varying(255) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Incompleto'::character varying,
    CONSTRAINT inscripciones_evento_pkey PRIMARY KEY (id_inscripcion),
    CONSTRAINT inscripciones_evento_id_equipo_id_evento_unique UNIQUE (id_equipo, id_evento)
);

CREATE TABLE IF NOT EXISTS public.job_batches
(
    id character varying(255) COLLATE pg_catalog."default" NOT NULL,
    name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    total_jobs integer NOT NULL,
    pending_jobs integer NOT NULL,
    failed_jobs integer NOT NULL,
    failed_job_ids text COLLATE pg_catalog."default" NOT NULL,
    options text COLLATE pg_catalog."default",
    cancelled_at integer,
    created_at integer NOT NULL,
    finished_at integer,
    CONSTRAINT job_batches_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.jobs
(
    id bigserial NOT NULL,
    queue character varying(255) COLLATE pg_catalog."default" NOT NULL,
    payload text COLLATE pg_catalog."default" NOT NULL,
    attempts smallint NOT NULL,
    reserved_at integer,
    available_at integer NOT NULL,
    created_at integer NOT NULL,
    CONSTRAINT jobs_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.jurados
(
    id_usuario bigint NOT NULL,
    cedula_profesional character varying(50) COLLATE pg_catalog."default",
    especialidad character varying(100) COLLATE pg_catalog."default",
    empresa_institucion character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT jurados_pkey PRIMARY KEY (id_usuario)
);

CREATE TABLE IF NOT EXISTS public.logros
(
    id_logro bigserial NOT NULL,
    nombre character varying(255) COLLATE pg_catalog."default" NOT NULL,
    descripcion text COLLATE pg_catalog."default" NOT NULL,
    icono character varying(50) COLLATE pg_catalog."default",
    tipo character varying(50) COLLATE pg_catalog."default" NOT NULL,
    condicion character varying(255) COLLATE pg_catalog."default" NOT NULL,
    puntos_xp integer NOT NULL,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT logros_pkey PRIMARY KEY (id_logro)
);

CREATE TABLE IF NOT EXISTS public.miembros_equipo
(
    id_miembro bigserial NOT NULL,
    id_inscripcion bigint NOT NULL,
    id_estudiante bigint NOT NULL,
    id_rol_equipo bigint NOT NULL,
    es_lider boolean NOT NULL DEFAULT false,
    CONSTRAINT miembros_equipo_pkey PRIMARY KEY (id_miembro),
    CONSTRAINT miembros_equipo_id_inscripcion_id_estudiante_unique UNIQUE (id_inscripcion, id_estudiante)
);

CREATE TABLE IF NOT EXISTS public.migrations
(
    id serial NOT NULL,
    migration character varying(255) COLLATE pg_catalog."default" NOT NULL,
    batch integer NOT NULL,
    CONSTRAINT migrations_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.password_reset_tokens
(
    email character varying(255) COLLATE pg_catalog."default" NOT NULL,
    token character varying(255) COLLATE pg_catalog."default" NOT NULL,
    created_at timestamp(0) without time zone,
    CONSTRAINT password_reset_tokens_pkey PRIMARY KEY (email)
);

CREATE TABLE IF NOT EXISTS public.proyectos
(
    id_proyecto bigserial NOT NULL,
    id_inscripcion bigint NOT NULL,
    nombre character varying(200) COLLATE pg_catalog."default" NOT NULL,
    descripcion_tecnica text COLLATE pg_catalog."default",
    repositorio_url character varying(255) COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT proyectos_pkey PRIMARY KEY (id_proyecto),
    CONSTRAINT proyectos_id_inscripcion_unique UNIQUE (id_inscripcion)
);

CREATE TABLE IF NOT EXISTS public.proyectos_evento
(
    id_proyecto_evento bigserial NOT NULL,
    id_evento bigint NOT NULL,
    id_inscripcion bigint,
    titulo character varying(200) COLLATE pg_catalog."default" NOT NULL,
    descripcion_completa text COLLATE pg_catalog."default",
    objetivo text COLLATE pg_catalog."default",
    requisitos text COLLATE pg_catalog."default",
    premios text COLLATE pg_catalog."default",
    archivo_bases character varying(255) COLLATE pg_catalog."default",
    archivo_recursos character varying(255) COLLATE pg_catalog."default",
    url_externa character varying(255) COLLATE pg_catalog."default",
    publicado boolean NOT NULL DEFAULT false,
    fecha_publicacion timestamp(0) without time zone,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT proyectos_evento_pkey PRIMARY KEY (id_proyecto_evento),
    CONSTRAINT proyectos_evento_id_evento_id_inscripcion_unique UNIQUE (id_evento, id_inscripcion)
);

CREATE TABLE IF NOT EXISTS public.recurso_equipos
(
    id_recurso bigserial NOT NULL,
    id_equipo bigint NOT NULL,
    subido_por bigint NOT NULL,
    nombre character varying(255) COLLATE pg_catalog."default" NOT NULL,
    tipo character varying(50) COLLATE pg_catalog."default" NOT NULL,
    url character varying(255) COLLATE pg_catalog."default" NOT NULL,
    descripcion text COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT recurso_equipos_pkey PRIMARY KEY (id_recurso)
);

CREATE TABLE IF NOT EXISTS public.sessions
(
    id character varying(255) COLLATE pg_catalog."default" NOT NULL,
    user_id bigint,
    ip_address character varying(45) COLLATE pg_catalog."default",
    user_agent text COLLATE pg_catalog."default",
    payload text COLLATE pg_catalog."default" NOT NULL,
    last_activity integer NOT NULL,
    CONSTRAINT sessions_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.solicitudes_union
(
    id bigserial NOT NULL,
    equipo_id bigint NOT NULL,
    estudiante_id bigint NOT NULL,
    status character varying(255) COLLATE pg_catalog."default" NOT NULL DEFAULT 'pendiente'::character varying,
    mensaje text COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT solicitudes_union_pkey PRIMARY KEY (id),
    CONSTRAINT solicitudes_union_equipo_id_estudiante_id_unique UNIQUE (equipo_id, estudiante_id)
);

CREATE TABLE IF NOT EXISTS public.tareas_proyecto
(
    id_tarea bigserial NOT NULL,
    id_proyecto bigint NOT NULL,
    nombre character varying(150) COLLATE pg_catalog."default" NOT NULL,
    descripcion text COLLATE pg_catalog."default",
    asignado_a bigint,
    completada boolean NOT NULL DEFAULT false,
    completada_por bigint,
    fecha_completada timestamp(0) without time zone,
    fecha_limite date,
    prioridad character varying(255) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Media'::character varying,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT tareas_proyecto_pkey PRIMARY KEY (id_tarea)
);

CREATE TABLE IF NOT EXISTS public.tokens_jurado
(
    id_token bigserial NOT NULL,
    token character varying(64) COLLATE pg_catalog."default" NOT NULL,
    usado boolean NOT NULL DEFAULT false,
    fecha_expiracion timestamp(0) without time zone NOT NULL,
    email_invitado character varying(150) COLLATE pg_catalog."default",
    CONSTRAINT tokens_jurado_pkey PRIMARY KEY (id_token),
    CONSTRAINT tokens_jurado_token_unique UNIQUE (token)
);

CREATE TABLE IF NOT EXISTS public.users
(
    id_usuario bigserial NOT NULL,
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    app_paterno character varying(100) COLLATE pg_catalog."default" NOT NULL,
    app_materno character varying(100) COLLATE pg_catalog."default",
    email character varying(150) COLLATE pg_catalog."default" NOT NULL,
    password character varying(255) COLLATE pg_catalog."default" NOT NULL,
    foto_perfil character varying(255) COLLATE pg_catalog."default",
    id_rol_sistema bigint NOT NULL,
    activo boolean NOT NULL DEFAULT true,
    remember_token character varying(100) COLLATE pg_catalog."default",
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT users_pkey PRIMARY KEY (id_usuario),
    CONSTRAINT users_email_unique UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS public.usuario_logros
(
    id_usuario_logro bigserial NOT NULL,
    id_usuario bigint NOT NULL,
    id_logro bigint NOT NULL,
    id_evento bigint,
    fecha_obtencion timestamp(0) without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_at timestamp(0) without time zone,
    updated_at timestamp(0) without time zone,
    CONSTRAINT usuario_logros_pkey PRIMARY KEY (id_usuario_logro),
    CONSTRAINT usuario_logros_id_usuario_id_logro_id_evento_unique UNIQUE (id_usuario, id_logro, id_evento)
);

ALTER TABLE IF EXISTS public.actividades
    ADD CONSTRAINT actividades_id_equipo_foreign FOREIGN KEY (id_equipo)
    REFERENCES public.equipos (id_equipo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS actividades_id_equipo_index
    ON public.actividades(id_equipo);


ALTER TABLE IF EXISTS public.actividades
    ADD CONSTRAINT actividades_id_evento_foreign FOREIGN KEY (id_evento)
    REFERENCES public.eventos (id_evento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS actividades_id_evento_index
    ON public.actividades(id_evento);


ALTER TABLE IF EXISTS public.actividades
    ADD CONSTRAINT actividades_id_usuario_foreign FOREIGN KEY (id_usuario)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.avances
    ADD CONSTRAINT avances_id_proyecto_foreign FOREIGN KEY (id_proyecto)
    REFERENCES public.proyectos (id_proyecto) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.avances
    ADD CONSTRAINT avances_id_usuario_registro_foreign FOREIGN KEY (id_usuario_registro)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.constancias
    ADD CONSTRAINT constancias_id_evento_foreign FOREIGN KEY (id_evento)
    REFERENCES public.eventos (id_evento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.constancias
    ADD CONSTRAINT constancias_id_usuario_foreign FOREIGN KEY (id_usuario)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.criterios_evaluacion
    ADD CONSTRAINT criterios_evaluacion_id_evento_foreign FOREIGN KEY (id_evento)
    REFERENCES public.eventos (id_evento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.estudiante_habilidades
    ADD CONSTRAINT estudiante_habilidades_id_habilidad_foreign FOREIGN KEY (id_habilidad)
    REFERENCES public.cat_habilidades (id_habilidad) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.estudiante_habilidades
    ADD CONSTRAINT estudiante_habilidades_id_usuario_foreign FOREIGN KEY (id_usuario)
    REFERENCES public.estudiantes (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.estudiante_stats
    ADD CONSTRAINT estudiante_stats_id_usuario_foreign FOREIGN KEY (id_usuario)
    REFERENCES public.estudiantes (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS estudiante_stats_pkey
    ON public.estudiante_stats(id_usuario);


ALTER TABLE IF EXISTS public.estudiantes
    ADD CONSTRAINT estudiantes_id_carrera_foreign FOREIGN KEY (id_carrera)
    REFERENCES public.cat_carreras (id_carrera) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.estudiantes
    ADD CONSTRAINT estudiantes_id_usuario_foreign FOREIGN KEY (id_usuario)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS estudiantes_pkey
    ON public.estudiantes(id_usuario);


ALTER TABLE IF EXISTS public.evaluacion_criterios
    ADD CONSTRAINT evaluacion_criterios_id_criterio_foreign FOREIGN KEY (id_criterio)
    REFERENCES public.criterios_evaluacion (id_criterio) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.evaluacion_criterios
    ADD CONSTRAINT evaluacion_criterios_id_evaluacion_foreign FOREIGN KEY (id_evaluacion)
    REFERENCES public.evaluaciones (id_evaluacion) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.evaluaciones
    ADD CONSTRAINT evaluaciones_id_inscripcion_foreign FOREIGN KEY (id_inscripcion)
    REFERENCES public.inscripciones_evento (id_inscripcion) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.evaluaciones
    ADD CONSTRAINT evaluaciones_id_jurado_foreign FOREIGN KEY (id_jurado)
    REFERENCES public.jurados (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.evaluaciones_avances
    ADD CONSTRAINT evaluaciones_avances_id_avance_foreign FOREIGN KEY (id_avance)
    REFERENCES public.avances (id_avance) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.evaluaciones_avances
    ADD CONSTRAINT evaluaciones_avances_id_jurado_foreign FOREIGN KEY (id_jurado)
    REFERENCES public.jurados (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.evento_jurados
    ADD CONSTRAINT evento_jurados_id_evento_foreign FOREIGN KEY (id_evento)
    REFERENCES public.eventos (id_evento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.evento_jurados
    ADD CONSTRAINT evento_jurados_id_jurado_foreign FOREIGN KEY (id_jurado)
    REFERENCES public.jurados (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.inscripciones_evento
    ADD CONSTRAINT inscripciones_evento_id_equipo_foreign FOREIGN KEY (id_equipo)
    REFERENCES public.equipos (id_equipo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.inscripciones_evento
    ADD CONSTRAINT inscripciones_evento_id_evento_foreign FOREIGN KEY (id_evento)
    REFERENCES public.eventos (id_evento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.jurados
    ADD CONSTRAINT jurados_id_usuario_foreign FOREIGN KEY (id_usuario)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS jurados_pkey
    ON public.jurados(id_usuario);


ALTER TABLE IF EXISTS public.miembros_equipo
    ADD CONSTRAINT miembros_equipo_id_estudiante_foreign FOREIGN KEY (id_estudiante)
    REFERENCES public.estudiantes (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.miembros_equipo
    ADD CONSTRAINT miembros_equipo_id_inscripcion_foreign FOREIGN KEY (id_inscripcion)
    REFERENCES public.inscripciones_evento (id_inscripcion) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.miembros_equipo
    ADD CONSTRAINT miembros_equipo_id_rol_equipo_foreign FOREIGN KEY (id_rol_equipo)
    REFERENCES public.cat_roles_equipo (id_rol_equipo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.proyectos
    ADD CONSTRAINT proyectos_id_inscripcion_foreign FOREIGN KEY (id_inscripcion)
    REFERENCES public.inscripciones_evento (id_inscripcion) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS proyectos_id_inscripcion_unique
    ON public.proyectos(id_inscripcion);


ALTER TABLE IF EXISTS public.proyectos_evento
    ADD CONSTRAINT proyectos_evento_id_evento_foreign FOREIGN KEY (id_evento)
    REFERENCES public.eventos (id_evento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.proyectos_evento
    ADD CONSTRAINT proyectos_evento_id_inscripcion_foreign FOREIGN KEY (id_inscripcion)
    REFERENCES public.inscripciones_evento (id_inscripcion) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.recurso_equipos
    ADD CONSTRAINT recurso_equipos_id_equipo_foreign FOREIGN KEY (id_equipo)
    REFERENCES public.equipos (id_equipo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.recurso_equipos
    ADD CONSTRAINT recurso_equipos_subido_por_foreign FOREIGN KEY (subido_por)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.solicitudes_union
    ADD CONSTRAINT solicitudes_union_equipo_id_foreign FOREIGN KEY (equipo_id)
    REFERENCES public.equipos (id_equipo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.solicitudes_union
    ADD CONSTRAINT solicitudes_union_estudiante_id_foreign FOREIGN KEY (estudiante_id)
    REFERENCES public.estudiantes (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.tareas_proyecto
    ADD CONSTRAINT tareas_proyecto_asignado_a_foreign FOREIGN KEY (asignado_a)
    REFERENCES public.miembros_equipo (id_miembro) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET NULL;


ALTER TABLE IF EXISTS public.tareas_proyecto
    ADD CONSTRAINT tareas_proyecto_completada_por_foreign FOREIGN KEY (completada_por)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.tareas_proyecto
    ADD CONSTRAINT tareas_proyecto_id_proyecto_foreign FOREIGN KEY (id_proyecto)
    REFERENCES public.proyectos (id_proyecto) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.users
    ADD CONSTRAINT users_id_rol_sistema_foreign FOREIGN KEY (id_rol_sistema)
    REFERENCES public.cat_roles_sistema (id_rol_sistema) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.usuario_logros
    ADD CONSTRAINT usuario_logros_id_evento_foreign FOREIGN KEY (id_evento)
    REFERENCES public.eventos (id_evento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET NULL;


ALTER TABLE IF EXISTS public.usuario_logros
    ADD CONSTRAINT usuario_logros_id_logro_foreign FOREIGN KEY (id_logro)
    REFERENCES public.logros (id_logro) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.usuario_logros
    ADD CONSTRAINT usuario_logros_id_usuario_foreign FOREIGN KEY (id_usuario)
    REFERENCES public.users (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;

END;